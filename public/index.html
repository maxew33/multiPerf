<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Audit Lighthouse</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    textarea { width: 100%; height: 150px; }
    iframe { width: 100%; height: 600px; border: none; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Audit Lighthouse Web</h1>
  <form id="audit-form">
    <label>Entrez les URLs (une par ligne) :</label><br>
    <textarea name="urls"></textarea><br>
    <button type="submit">Lancer l'audit</button>
  </form>

  <div id="results"></div>
  <div id="loader" style="display:none; margin-top: 1rem;">
    <p>üïê Audit en cours... Veuillez patienter.</p>
  </div>
  
  <script>
    document.getElementById('audit-form').addEventListener('submit', async (e) => {
      e.preventDefault();
  
      const textarea = e.target.elements.urls;
      const urls = textarea.value.trim().split('\n').filter(Boolean);
      const loader = document.getElementById('loader');
      const results = document.getElementById('results');
  
      if (!urls.length) {
        alert('Veuillez entrer au moins une URL.');
        return;
      }
  
      // Affiche le loader
      loader.style.display = 'block';
      results.innerHTML = '';
  
      try {
        const response = await fetch('/audit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ urls })
        });
  
        const data = await response.json();
  
        // Cache le loader
        loader.style.display = 'none';
  
        if (!data.reports.length) {
          results.innerHTML = '<p>Aucun rapport g√©n√©r√©.</p>';
          return;
        }
  
        data.reports.forEach(report => {
          const iframe = document.createElement('iframe');
          iframe.src = report;
          results.appendChild(iframe);
        });
      } catch (error) {
        loader.style.display = 'none';
        console.error('Erreur:', error);
        alert("Erreur lors de l'audit. Consultez la console.");
      }
    });
  </script>
  
</body>
</html>
